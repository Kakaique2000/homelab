#!/bin/bash
# Wrapper script for k9s using local kubeconfig

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
KUBECONFIG_FILE="$SCRIPT_DIR/.kube/config"

if [ ! -f "$KUBECONFIG_FILE" ]; then
  echo "ERROR: Kubeconfig not found at $KUBECONFIG_FILE"
  echo ""
  echo "Please run ./5-install-kubernetes.sh first to download the kubeconfig"
  echo "Or manually download it:"
  echo "  mkdir -p $SCRIPT_DIR/.kube"
  echo "  scp ansible-agent@\$MASTER_IP:~/.kube/config $KUBECONFIG_FILE"
  exit 1
fi

# Check if k9s is installed
if ! command -v k9s &> /dev/null; then
  echo "ERROR: k9s is not installed"
  echo ""
  echo "Install k9s with:"
  echo "  # On Ubuntu/Debian"
  echo "  wget https://github.com/derailed/k9s/releases/download/v0.32.4/k9s_Linux_amd64.tar.gz"
  echo "  tar -xzf k9s_Linux_amd64.tar.gz"
  echo "  sudo mv k9s /usr/local/bin/"
  echo ""
  echo "  # Or with snap"
  echo "  sudo snap install k9s"
  echo ""
  echo "  # Or with go"
  echo "  go install github.com/derailed/k9s@latest"
  exit 1
fi

export KUBECONFIG="$KUBECONFIG_FILE"
k9s "$@"
